<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pagecontent</title>

    <!-- Material Design -->
    <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
        rel="stylesheet">
    <!-- ICON CSS -->
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css">

    <!-- globalstyle -->
    <link rel="stylesheet" href="../css/globalstyle.css">
    <!-- globalattributes -->
    <link rel="stylesheet" href="../css/globalattributes.css">

    <!-- 複數頁面使用CSS效果 -->
    <link rel="stylesheet" href="/css/pluralpagestyle.css">

    <style>
        /* 表格 --------------------------------------------------------- */

        .orderSelltable {
            table-layout: fixed;
            text-align: center;

            border-collapse: separate;
            border-spacing: 0;
            border-radius: 0.3rem;
            border: 1px solid var(--color-border);
        }

        .orderSelltable th {
            height: var(--table-thheight);

            color: var(--color-secfont);
            font-weight: var(--font-weight-contenttitle);
            background-color: var(--color-sectablesecond);
        }

        .orderSelltable td {
            /* height: var(--table-tdheight); */
            padding-top: 18px;
            padding-bottom: 18px;
            border-top: 1px solid var(--color-border);
        }




        .detailTable {
            display: none;
            margin-left: auto;
            margin-right: auto;
            width: 100%;
            line-height: 25px;
            font-size: 10px;
            border: 2px solid var(--color-black);
            background-color: var(--color-whitesmoke);
            width: 90%;

        }

        .detailTh {
            height: 30px;
            font-size: 12px;
            border: 2px solid var(--color-black);
            background-color: var(--color-jasmine);
        }

        .detailBtn {
            color: var(--color-black);
            background-color: transparent;
            border-color: var(--color-black);
            background-color: var(--color-jasmine);
            border-radius: 3px;
            padding-right: 2%;
            padding-left: 2%;

        }

        @media screen and (max-width: 1000px) {
            table {
                border: 0;
            }

            table thead {
                overflow: hidden;
                padding: 0;
                position: absolute;
                width: 1px;
            }

            table tr {
                border-bottom: 3px solid var(--color-antiquewhite);
                display: block;
                font-size: 16px;
            }

            table td {
                border-bottom: 1px solid var(--color-antiquewhite);
                display: block;
                text-align: right;

            }

            table td::before {
                content: attr(data-label);
                float: left;
                font-weight: bold;
                text-transform: uppercase;
                color: var(--color-sunorange);
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="row justify-content-center">

            <!-- border border-primary  -->
            <div class="col-11 mt-4 px-0">

                <h1 class="fs-2 fw-bold mb-4"><span class="text-black">接單管理</span></h1>

                <div class="bg-white rounded-3 shadow-sm py-4 px-4 w-100 h-auto mb-4">

                    <!-- 這裡是內容的框架，可直接改掉框架 -->

                    <div class="h-auto d-flex justify-content-start fs-6 fw-normal">
                        <a class="opA active">全部</a>
                        <a class="opA">待確認</a>
                        <a class="opA">待出貨</a>
                        <a class="opA">出貨中</a>
                        <a class="opA">已完成</a>
                        <a class="opA">不成立</a>
                    </div>

                    <div class="borderLine"></div>

                    <hr class="hr-color mt-0 mb-4">



                    <table class="orderSelltable fs-6 fw-normal mb-4">
                        <thead>
                            <tr>
                                <th style="width: 10%;">接單編號</th>
                                <th style="width: 15%;">採購商</th>
                                <th style="width: 10%;">下單時間</th>
                                <th style="width: 10%;">交易狀態</th>
                                <th style="width: 10%;">銷售合計</th>
                                <th style="width: 10%;">利潤</th>
                                <th style="width: 15%;">操作</th>
                            </tr>
                        </thead>


                        <tr class="hiddenRowControll"></tr>
                        <tr class="hiddenRowControll"></tr>
                        <tr class="hiddenRowControll"></tr>
                        <tr class="hiddenRowControll"></tr>
                        <tr class="hiddenRowControll"></tr>

                    </table>

                    <div class="pagination">
                        <a href="#">&laquo;</a>
                        <a class="active" href="#">1</a>
                        <a href="#">2</a>
                        <a href="#">3</a>
                        <a href="#">4</a>
                        <a href="#">5</a>
                        <a href="#">&raquo;</a>
                    </div>

                </div>

            </div>

        </div>
    </div>


    <!-- 明細彈窗 -->
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">訂單明細</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" style="height: 700px;">
                    <iframe id="ifrm" style="width: 100%; flex: 1; height: 700px;" src="./littleDetail.html"></iframe>
                </div>
                <div class="modal-footer">
                    <!-- <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Understood</button> -->
                </div>
            </div>
        </div>
    </div>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/javascript/materialdesigninit.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>


    <script>
        // 上方選單移動與選擇
        // 最上方按鈕點擊時，按鈕狀態改變，下方底線移動。
        $(".opA").on("click", function () {
            $(".opA").removeClass('active');
            $(this).addClass('active');

            console.log($("tr"));

            switch ($(this).index()) {
                case 0:
                    $(".borderLine").css({ "transform": "translateX(0px)", "width": "70px" });
                    $(".hiddenRowControll").show();
                    break;
                case 1:
                    $(".borderLine").css({ "transform": "translateX(70px)", "width": "90px" });
                    $(".hiddenRowControll").hide();
                    $(".hiddenRowControll:nth-child(1)").show();
                    $(".hiddenRowControll:nth-child(2)").show();
                    break;
                case 2:
                    $(".borderLine").css({ "transform": "translateX(158px)", "width": "90px" });
                    $(".hiddenRowControll").hide();
                    $(".hiddenRowControll:nth-child(3)").show();
                    break;
                case 3:
                    $(".borderLine").css({ "transform": "translateX(245px)", "width": "90px" });
                    $(".hiddenRowControll").hide();
                    $(".hiddenRowControll:nth-child(4)").show();
                    $(".hiddenRowControll:nth-child(5)").show();
                    break;
                case 4:
                    $(".borderLine").css({ "transform": "translateX(338px)", "width": "90px" });
                    $(".hiddenRowControll").hide();
                    break;
                case 5:
                    $(".borderLine").css({ "transform": "translateX(428px)", "width": "90px" });
                    $(".hiddenRowControll").hide();
                    break;
                default:
                    console.log("borderLine狀態錯誤");
                    break;
            }

        })


        // 目前分頁按鈕位置，初始化為最左邊1。-------------------------------------------------------------------------------------------------

        let nowPageNum = 1;
        // 最下方分頁鈕點擊時，按鈕狀態改變。
        $(".pagination a").on("click", function () {
            if ($(this).index() != 0 && $(this).index() != 6) {
                $(".pagination a").removeClass('active');
                $(this).addClass('active');
                nowPageNum = $(this).index();

                // 變換表格內容。

            } else if ($(this).index() == 0) {

                // 如果最左邊的第一個數字是1，就不會更新頁籤。
                if ($(".pagination a")[1].innerHTML != 1) {

                    // 更新頁籤碼，所有頁籤碼-1
                    for (var i = 1; i <= 5; i++) {
                        let pageNum = parseInt($(".pagination a")[i].innerHTML);
                        $(".pagination a")[i].innerHTML = pageNum - 1;
                    }

                    // 更新active位置。
                    // 如果active位置在5，則不移動。
                    // 非5時，向右移動一格。
                    if (nowPageNum != 5) {
                        $(".pagination a").removeClass('active');
                        $(".pagination a")[nowPageNum + 1].classList.add('active');
                        nowPageNum += 1;

                    } else {
                        $(".pagination a").removeClass('active');
                        $(".pagination a")[nowPageNum].classList.add('active');
                        nowPageNum = 5;
                    }

                }

            } else {

                // 更新頁籤碼，所有頁籤碼+1
                for (var i = 1; i <= 5; i++) {
                    let pageNum = parseInt($(".pagination a")[i].innerHTML);
                    $(".pagination a")[i].innerHTML = pageNum + 1;
                }

                // 更新active位置。
                // 如果active位置在1，則不移動。
                // 非1時，向左移動一格。
                if (nowPageNum != 1) {
                    $(".pagination a").removeClass('active');
                    $(".pagination a")[nowPageNum - 1].classList.add('active');
                    nowPageNum -= 1;

                } else {
                    $(".pagination a").removeClass('active');
                    $(".pagination a")[nowPageNum].classList.add('active');
                    nowPageNum = 1;
                }

            }
        })

        //----------------------------------------------------------------------------------------------------------------------------------


        // 呼叫model開啟，同時呼叫開啟的內部iframe方法.parentCall(0)
        function callStaticBackdrop(showcontent) {

            if (showcontent == 0) {
                // 0是待確認時，無收件人資料
                $(".modal-body").css("height", "500px");
                $("#ifrm").css("height", "500px");
                $("#staticBackdrop").modal("show");
                $("#ifrm").get(0).contentWindow.parentCall(0);

            } else if (showcontent == 1) {
                // 1是完整資料，含收件人資料
                $(".modal-body").css("height", "700px");
                $("#ifrm").css("height", "700px");
                $("#staticBackdrop").modal("show");
                $("#ifrm").get(0).contentWindow.parentCall(1);

            } else if (showcontent == 2) {
                // 2是訂單不成立，無收件人資料
                $(".modal-body").css("height", "700px");
                $("#ifrm").css("height", "700px");
                $("#staticBackdrop").modal("show");
                $("#ifrm").get(0).contentWindow.parentCall(2);

            }

        }

        // iframe內部的子類會呼叫這個方法。
        function SetComponent() {
            $("#staticBackdrop").modal("hide");
        }

    </script>

    <!-- 假資料在這 -->
    <script>
        // JSON假資料  ----------------------------------------------------------------------------------------------------------------------
        // OrderId(接單編號)、CompanyName(採購商)、OrderTime(下單時間)、OrderStatus(交易狀態)、?total(?銷售合計(大總價))、?profit(?利潤)
        // OrderStatus(交易狀態)：1是尚未送出叫貨單_還沒送出訂單、2是待確認_訂單送出、3是待出貨_訂單成立、4是出貨中、5是待收貨_待收貨入庫、6是訂單完成_入庫完成、7是訂單不成立_賣家或買家取消
        var allSellList =
            [
                {
                    OrderId: "#22091285497",
                    CompanyName: "台發有限公司",
                    OrderTime: "2022-09-18 20:09:19",
                    OrderStatus: 2,
                    total: 2330,
                    profit: 1330
                },
                {
                    OrderId: "#22098857193",
                    CompanyName: "豪堡商行",
                    OrderTime: "2022-09-11 11:17:18",
                    OrderStatus: 7,
                    total: 6260,
                    profit: 2260
                },
                {
                    OrderId: "#22090095710",
                    CompanyName: "聖弘企業社",
                    OrderTime: "2022-09-10 18:29:09",
                    OrderStatus: 4,
                    total: 19320,
                    profit: 10000
                },
                {
                    OrderId: "#22098857193",
                    CompanyName: "豪堡商行",
                    OrderTime: "2022-09-11 11:17:18",
                    OrderStatus: 7,
                    total: 6260,
                    profit: 2260
                },
                {
                    OrderId: "#22090095710",
                    CompanyName: "聖弘企業社",
                    OrderTime: "2022-09-10 18:29:09",
                    OrderStatus: 4,
                    total: 19320,
                    profit: 10000
                }
            ];

        // 欄位中文名稱對應
        let sellListName = [
            {
                OrderId: "接單編號",
                CompanyName: "採購商",
                OrderTime: "下單時間",
                OrderStatus: "交易狀態",
                total: "銷售合計",
                profit: "利潤"
            }
        ]

        // 撈資料(使用非同步資料的方式撈)。
        downloadData();
        async function downloadData() {

            // 與Server對接的ajax。
            // 邊撈同時進行後續動作。
            // var result = await $.ajax({
            //     type: "get",
            //     url: "http://localhost:3000/home/news"
            // });

            // allStockList = JSON.parse(result);

            // 撈完後解析假資料並更新畫面內容。
            reNewData();
        }


        function reNewData() {
            let pageDataNum = 5;  //每頁最多5筆資料。

            for (let i = 1; i <= pageDataNum; i++) {

                // 清空Table，把除了<th>內部<tr>之外的所有<tr>清空。
                $(".orderSelltable tr")[i].innerHTML = "";

                // 判斷交易狀態
                let theStatus = null;
                switch (allSellList[i - 1].OrderStatus) {
                    case 2:
                        theStatus = "待我方確認";
                        break;
                    case 3:
                        theStatus = "待我方出貨";
                        break;
                    case 4:
                        theStatus = "我方出貨中";
                        break;
                    case 5:
                        theStatus = "待採購商收貨";
                        break;
                    case 6:
                        theStatus = "訂單完成";
                        break;
                    case 7:
                        theStatus = "不成立";
                        break;
                    default:
                        console.log("交易狀態錯誤");
                        break;
                }


                // 判斷幾個按鈕
                let theButton = null;
                switch (allSellList[i - 1].OrderStatus) {
                    case 2:
                        theButton = `<button class="orderBtn mdc-button mdc-button--raised mb-2">
                                    <span class="mdc-button__label fs-6 fw-normal">確認訂單</span>
                                </button><br>
                                <button class="orderBtnDel mdc-button mdc-button--outlined mb-2">
                                    <span class="mdc-button__ripple"></span>
                                    <span class="mdc-button__label fs-6 fw-normal">取消訂單</span>
                                </button><br>
                                <button class="detail mdc-button" onclick="callStaticBackdrop(0)">
                                    <span class="mdc-button__ripple"></span>
                                    <span class="mdc-button__label fs-6 fw-normal">查看明細</span>
                                </button>`;
                        break;
                    case 3: case 4: case 5:
                        theButton = `<button class="orderBtnDel mdc-button mdc-button--outlined mb-2">
                                    <span class="mdc-button__ripple"></span>
                                    <span class="mdc-button__label fs-6 fw-normal">取消訂單</span>
                                </button><br>
                                <button class="detail mdc-button" onclick="callStaticBackdrop(1)">
                                    <span class="mdc-button__ripple"></span>
                                    <span class="mdc-button__label fs-6 fw-normal">查看明細</span>
                                </button>`;
                        break;
                    case 6: case 7:
                        theButton = `<button class="detail mdc-button" onclick="callStaticBackdrop(2)">
                                    <span class="mdc-button__ripple"></span>
                                    <span class="mdc-button__label fs-6 fw-normal">查看明細</span>
                                </button>`;
                        break;

                    default:
                        console.log("按鈕錯誤");
                        break;
                }

                // 創造<tr>的Html格式，並將資料帶入。
                let trHtmlData =
                    `<td data-label=${sellListName[0].OrderId}>${allSellList[i - 1].OrderId}</td>
                            <td data-label=${sellListName[0].CompanyName}>${allSellList[i - 1].CompanyName}</td>
                            <td data-label=${sellListName[0].OrderTime}>${allSellList[i - 1].OrderTime}</td>
                            <td data-label=${sellListName[0].OrderStatus}>${theStatus}</td>
                            <td data-label=${sellListName[0].total}>${allSellList[i - 1].total}</td>
                            <td data-label=${sellListName[0].profit}>${allSellList[i - 1].profit}</td>
                            <td data-label="操作">
                                ${theButton}
                            </td>`
                // 把製作完的tr放回去tabel中。
                $(".orderSelltable tr")[i].innerHTML = trHtmlData;


            }
        }

    </script>


    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.pack.js"></script>

    <!-- 確認刪除 -->
    <script>


        // 確認訂單------------------------------------------------------------
        $(".orderBtn").on('click', function () {
            Swal.fire({
                title: '已確認訂單',
                text: '請於有效時間內安排訂單出貨',
                icon: 'success',
                confirmButtonColor: 'var(--color-marigold)'
            })
            $(this).closest("tr").find("button")[0].innerHTML = "確認出貨";
            $(this).hide();
        });

        // 取消訂單------------------------------------------------------------
        $(".orderBtnDel").on('click', function () {
            Swal.fire({

                title: '已取消訂單',
                text: '您的該筆訂單交易狀態更改為【不成立】',
                icon: 'warning',
                confirmButtonColor: 'var(--color-marigold)'
            })

            $(this).closest("tr").find("td")[3].innerHTML = "不成立";
            $(this).hide();
        });


    </script>


</body>

</html>